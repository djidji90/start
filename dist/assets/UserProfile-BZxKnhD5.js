import{r as t,J as z,j as a,z as S,A as m,H as A,G as d}from"./index-C7bfEiFr.js";import{A as w,a as p}from"./index-COPrfliv.js";import{T as h}from"./TextField-DIqtkQAg.js";import{S as U}from"./Snackbar-DV5iNCLa.js";const $=()=>{const[j,f]=t.useState(null),[u,g]=t.useState(""),[i,x]=t.useState(""),[l,b]=t.useState(""),[s,n]=t.useState({}),[y,o]=t.useState(!1),[C,c]=t.useState(!1),[T,v]=t.useState(""),E=z();t.useEffect(()=>{(async()=>{o(!0);try{const r=await p.get("http://127.0.0.1:8000/api/user/",{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});f(r.data),g(r.data.name),x(r.data.email)}catch{n({general:"No se pudo obtener la información del usuario."})}finally{o(!1)}})()},[]);const I=()=>{const e={};return u.trim()||(e.name="El nombre no puede estar vacío."),i.trim()?/\S+@\S+\.\S+/.test(i)||(e.email="El correo electrónico no es válido."):e.email="El correo electrónico no puede estar vacío.",n(e),Object.keys(e).length===0},k=()=>{const e={};return l.trim()?l.length<6&&(e.password="La contraseña debe tener al menos 6 caracteres."):e.password="La nueva contraseña no puede estar vacía.",n(e),Object.keys(e).length===0},N=async e=>{if(e.preventDefault(),!!I()){o(!0);try{const r=await p.put("http://127.0.0.1:8000/api/user/",{name:u,email:i},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});v("Información actualizada correctamente."),c(!0),f(r.data)}catch{n({general:"Error al actualizar la información."})}finally{o(!1)}}},P=async e=>{if(e.preventDefault(),!!k()){o(!0);try{const r=await p.put("http://127.0.0.1:8000/api/change-password/",{password:l},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});v("Contraseña cambiada correctamente."),c(!0)}catch{n({general:"Error al cambiar la contraseña."})}finally{o(!1)}}},B=()=>{localStorage.removeItem("accessToken"),E("/login")};return a.jsxs(S,{sx:{padding:2},children:[a.jsx(m,{variant:"h4",children:"Perfil de Usuario"}),y&&a.jsx(A,{}),s.general&&a.jsx(w,{severity:"error",children:s.general}),j&&a.jsxs(S,{sx:{marginTop:3},children:[a.jsx(m,{variant:"h6",children:"Información Personal"}),a.jsxs("form",{onSubmit:N,children:[a.jsx(h,{fullWidth:!0,label:"Nombre",value:u,onChange:e=>g(e.target.value),sx:{marginBottom:2},error:!!s.name,helperText:s.name}),a.jsx(h,{fullWidth:!0,label:"Correo Electrónico",value:i,onChange:e=>x(e.target.value),sx:{marginBottom:2},error:!!s.email,helperText:s.email}),a.jsx(d,{type:"submit",variant:"contained",color:"primary",sx:{marginTop:2},children:"Actualizar Información"})]}),a.jsx(m,{variant:"h6",sx:{marginTop:4},children:"Cambiar Contraseña"}),a.jsxs("form",{onSubmit:P,children:[a.jsx(h,{fullWidth:!0,label:"Nueva Contraseña",type:"password",value:l,onChange:e=>b(e.target.value),sx:{marginBottom:2},error:!!s.password,helperText:s.password}),a.jsx(d,{type:"submit",variant:"contained",color:"secondary",sx:{marginTop:2},children:"Cambiar Contraseña"})]}),a.jsx(d,{variant:"outlined",color:"error",sx:{marginTop:4},onClick:B,children:"Cerrar Sesión"})]}),a.jsx(U,{open:C,autoHideDuration:6e3,onClose:()=>c(!1),children:a.jsx(w,{onClose:()=>c(!1),severity:"success",children:T})})]})};export{$ as default};
